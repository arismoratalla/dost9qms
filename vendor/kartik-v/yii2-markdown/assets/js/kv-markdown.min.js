/*!
 * ====================================================
 * kv-markdown.js
 * ====================================================
 * A markdown editor parser for PHP Markdown Extra and
 * PHP SmartyPants. Designed for Yii Framework 2.0
 *
 * https://github.com/kartik-v/yii2-markdown
 *
 * Copyright (c) 2014, Kartik Visweswaran
 * Krajee.com
 * Licensed under BSD-3 License.
 * Refer attached LICENSE.md for details.
 * Version: 1.3.0
 */
function isEmpty(e,t){return e===null||e===undefined||e==[]||e===""||t&&$.trim(e)===""}function isNumber(e){return!isNaN(parseFloat(e))&&isFinite(e)}function download(e,t,n,r){e.find('[name="export_filetype"]').val(n);e.find('[name="export_filename"]').val(t);e.find('[name="export_content"]').val(r);e.submit()}function genExportFile(e,t,n,r,i,s,o,u,a,f){alert(u);output=i+s;if(o=="HTML"){$.ajax({type:"POST",url:a,dataType:"json",data:{source:output,nullMsg:f},success:function(i){if(i){download(e,t,"htm",r+n+i)}else{alert("HTML conversion failed! Try again later.")}}})}else{download(e,t,"txt",output)}}function togglePreview(e){var t=e.editor,n=e.preview,r=e.source,i=e.target,s=e.url,o=e.progress,u=e.nullMsg;$(n).toggleClass("active");if($(i).hasClass("hidden")){disableButtons(t);$(n).removeAttr("disabled");$(r).addClass("hidden");$(i).removeClass("hidden");$.ajax({type:"POST",url:s,dataType:"json",data:{source:$(r).val(),nullMsg:u},beforeSend:function(){$(i).html(o)},success:function(e){$(i).html(e)}});$(i).focus()}else{enableButtons(t);$(r).removeClass("hidden");$(i).addClass("hidden");$(r).focus()}}function enableButtons(e){$(e+" button").each(function(){$(this).removeAttr("disabled")})}function disableButtons(e){$(e+" button").each(function(){if($(this).attr("data-enabled")==undefined){$(this).attr("disabled","disabled")}})}function getMarkUp(e,t,n){var r=t.length,i=n.length;var s=e;if(r>0){s=s.slice(0,r)==t?s.slice(r):t+s}if(i>0){s=s.slice(-i)==n?s.slice(0,-i):s+n}return s}function getBlockMarkUp(e,t,n){var r=e;if(r.indexOf("\n")<0){r=getMarkUp(e,t,n)}else{var i=[];i=e.split("\n");$.each(i,function(e,r){i[e]=getMarkUp(r.trimRight(),t,n+"  ")});r=i.join("\n")}return r}function markUp(e,t){var r=$(t);r.focus();var i=r.extractSelectedText(),s=i.length,o=i;if(e==1){o=i.length>0?getBlockMarkUp(i,"**","**"):"**(bold text here)**"}else if(e==2){o=i.length>0?getBlockMarkUp(i,"*","*"):"*(italic text here)*"}else if(e==3){o=i.length>0?getMarkUp(i,"\n","\n"):"\n(paragraph text here)\n"}else if(e==4){o=getBlockMarkUp(i,"","  ")}else if(e>100){n=e-100;var u="#".repeat(n);o=getMarkUp(i,u+" "," "+u)}else if(e==5){link=prompt("Insert Hyperlink","http://");o=link!=null&&link!=""&&link!="http://"?"["+i+"]("+link+")":i}else if(e==6){link=prompt("Insert Image Hyperlink","http://");o=link!=null&&link!=""&&link!="http://"?"!["+i+"]("+link+' "enter image title here")':i}else if(e==7){var o=i,a="  ";if(o.indexOf("\n")<0){o=a+o}else{var f=[];f=i.split("\n");$.each(f,function(e,t){f[e]=a+t});o=f.join("\n")}}else if(e==8){var o=i,a="  ";if(o.indexOf("\n")<0&&o.substr(0,2)==a){o=o.slice(2)}else{var f=[];f=i.split("\n");$.each(f,function(e,t){f[e]=t;if(t.substr(0,2)==a){f[e]=t.slice(2)}});o=f.join("\n")}}else if(e==9){o=getBlockMarkUp(i,"- ","")}else if(e==10){start=prompt("Enter starting number",1);if(start!=null&&start!=""){if(!isNumber(start)){start=1}if(i.indexOf("\n")<0){o=getMarkUp(i,start+". ","")}else{var f=[],l=start;f=i.split("\n");$.each(f,function(e,t){f[e]=getMarkUp(t,l+". ","");l++});o=f.join("\n")}}}else if(e==11){if(i.indexOf("\n")>0){var f=[],l=1;f=i.split("\n");$.each(f,function(e,t){tag=l%2==0?":    ":"";f[e]=getMarkUp(t,tag,"");l++});o=f.join("\n")}else{o=i+"\n:    \n"}}else if(e==12){title="Enter footnote ";notes="";if(i.indexOf("\n")<0){notes="[^1]: "+title+"1\n";o=getMarkUp(i,"",title+"[^1]")+"\n"+notes}else{var f=[],l=1;f=i.split("\n");$.each(f,function(e,t){id="[^"+l+"]";f[e]=getMarkUp(t,"",id+"  ");notes=notes+id+": "+title+l+"\n";l++});o=f.join("\n")+"  \n\n"+notes}}else if(e==13){o=getBlockMarkUp(i,"> ","  ")}else if(e==14){o=getMarkUp(i,"`","`")}else if(e==15){lang=prompt("Enter code language (e.g. html)","");if(isEmpty(lang,true)){lang=""}o=getMarkUp(i,"~~~"+lang+" \n","\n~~~  \n")}else if(e==16){o=getMarkUp(i,"","\n- - -")}if(!isEmpty(o)){r.replaceSelectedText(o,"select")}}function toggleScreen(e,t,n,r,i,s){h=$(window).height();if($(e).hasClass("active")){$(e).removeClass("active");val=$(r+" textarea").val();$(r+" textarea").height(s);$(r+" "+i).css("max-height",s);$(r+" "+n).clone(true).appendTo(t);$(t+" textarea").val(val);$(r+" "+n).remove();$(".kv-fullscreen").modal("hide")}else{$(e).addClass("active");val=$(t+" textarea").val();$(t+" "+n).clone(true).appendTo(r);$(t+" "+n).remove();$(r+" textarea").height(.75*h);$(r+" "+i).css("max-height",.75*h);$(r+" textarea").val(val);$(".kv-fullscreen").modal("show")}}function initEditor(e){var t=e.source,n=e.editor,r=e.preview,i=e.target,s=e.maximize,o=e.container,u=n.slice(1)+"-modal",a=e.export1,f=e.export2,l=e.height,c=$("#"+e.iframeId),h=c.contents().find("form");filename=e.filename;$(t).focus(function(){$(n).addClass("active")});$(t).blur(function(){$(n).removeClass("active")});$(r).click(function(){togglePreview(e)});$(a).click(function(){genExportFile(h,filename,"","",e.exportHeader,$(t).val(),"Text",e.exportText,e.url,e.nullMsg)});$(f).click(function(){genExportFile(h,filename,e.exportCss,e.exportMeta,e.exportHeader,$(t).val(),"HTML",e.exportHtml,e.url,e.nullMsg)});$("body").remove(".kv-fullscreen");$("body").append('<div class="modal fade kv-fullscreen" data-backdrop="static" data-keyboard=false><div class="modal-dialog"><div  id="'+u+'" class="modal-content"></div></div></div>');u="#"+u;$(n+" "+i).css("max-height",l);$(n+" textarea").height(l);$(s).click(function(){toggleScreen(s,o,n,u,i,l)})}String.prototype.trimRight=function(e){if(e===undefined){e="s"}return this.replace(new RegExp("["+e+"]+$"),"")};String.prototype.repeat=function(e){e=e||1;return Array(e+1).join(this)};